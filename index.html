<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seiren OS</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff69b4">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3461/3461877.png">

    <style>
        /* --- CORE 2000s AESTHETIC --- */
        :root {
            --pink: #ff69b4;
            --deep-pink: #d12e87;
            --blue: #4fc3f7;
            --bg: #fff0f5;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Verdana', sans-serif;
            background-color: var(--bg);
            /* Polka dot pattern */
            background-image: radial-gradient(#ffb7b2 15%, transparent 16%), radial-gradient(#ffb7b2 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            color: #444;
        }

        .scanlines {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%);
            background-size: 100% 3px; pointer-events: none; z-index: 999;
        }

        .app-shell {
            width: 100%; max-width: 480px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(5px);
            display: flex; flex-direction: column;
            position: relative; height: 100%;
        }

        /* HEADER */
        .marquee-container {
            background: linear-gradient(90deg, var(--pink), var(--deep-pink));
            color: white; padding: 6px 0;
            white-space: nowrap; overflow: hidden; border-bottom: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
            z-index: 10;
        }
        .marquee-text {
            display: inline-block; padding-left: 100%;
            animation: marquee 18s linear infinite; font-weight: bold; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 1px;
        }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .content {
            flex: 1; overflow-y: auto; padding: 20px;
            padding-bottom: 90px;
            scroll-behavior: smooth;
        }

        /* PAGES */
        .page { display: none; animation: slideUp 0.3s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        /* === 1. ID CARD (UPDATED WITH IMAGE) === */
        .id-card {
            background: white;
            border: 3px solid var(--blue); border-radius: 15px; padding: 15px;
            box-shadow: 6px 6px 0px rgba(79, 195, 247, 0.3);
            position: relative; overflow: hidden; margin-bottom: 25px;
        }
        
        .id-top-row { display: flex; gap: 15px; align-items: flex-start; }
        
        .avatar-frame {
            width: 90px; height: 90px;
            border: 3px solid var(--pink); border-radius: 10px;
            background: #fff; overflow: hidden;
        }
        .avatar-img { width: 100%; height: 100%; object-fit: cover; }

        .id-info { flex: 1; }
        .id-name {
            font-size: 1.4rem; font-weight: bold; color: var(--deep-pink);
            margin: 0; text-transform: uppercase; line-height: 1;
        }
        .id-meta { font-size: 0.75rem; color: #666; margin-top: 5px; }

        .stat-row { margin-top: 8px; display: flex; align-items: center; gap: 5px; font-size: 0.7rem; font-weight:bold; color:var(--blue); }
        .stat-bar-bg { flex: 1; height: 8px; background: #eee; border-radius: 4px; border:1px solid #ccc; }
        .stat-bar-fill { height: 100%; background: linear-gradient(90deg, var(--blue), #87cefa); border-radius: 4px; }

        /* === 2. BUDDY LIST (NEW FRIENDS LAYOUT) === */
        .buddy-container {
            background: white; border: 2px solid #ccc; border-radius: 5px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.05);
            min-height: 300px; display: flex; flex-direction: column;
        }
        
        .buddy-header {
            background: linear-gradient(180deg, #e0f7fa, #b2ebf2);
            padding: 8px; border-bottom: 1px solid #ccc;
            font-size: 0.8rem; font-weight: bold; color: #555;
            display: flex; justify-content: space-between; align-items: center;
        }

        .buddy-scroll { padding: 10px; overflow-y: auto; flex: 1; }

        .buddy-item {
            display: flex; align-items: center; gap: 10px;
            padding: 8px; border-bottom: 1px dotted #ddd;
            transition: 0.2s; cursor: pointer;
        }
        .buddy-item:hover { background: #f0f8ff; }
        
        .buddy-avatar {
            width: 40px; height: 40px; border-radius: 5px;
            border: 1px solid #aaa; background: white;
        }
        
        .buddy-info { display: flex; flex-direction: column; }
        .buddy-name { font-weight: bold; font-size: 0.9rem; color: #333; }
        .buddy-status { font-size: 0.7rem; color: #888; font-style: italic; }

        .add-buddy-box {
            margin-bottom: 15px; display: flex; gap: 5px;
        }

        /* === 3. SHARED UI ELEMENTS === */
        button { cursor: pointer; }
        
        input[type="text"], input[type="number"] {
            width: 100%; padding: 10px; border: 2px solid #ddd;
            border-radius: 8px; font-family: 'Verdana'; box-sizing: border-box;
        }
        input:focus { outline: none; border-color: var(--pink); }

        .btn-main {
            background: var(--pink); color: white; border: none; padding: 12px;
            border-radius: 20px; width: 100%; font-weight: bold;
            box-shadow: 0 4px 0 #c71585; transition: 0.1s;
        }
        .btn-main:active { transform: translateY(3px); box-shadow: 0 1px 0 #c71585; }

        /* FORTUNE CARD */
        .fortune-area { perspective: 800px; margin-top: 20px; text-align: center; }
        .card-wrap {
            width: 160px; height: 220px; margin: 0 auto;
            position: relative; transform-style: preserve-3d; transition: transform 0.6s;
        }
        .card-wrap.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 4px solid white;
        }
        .card-front { background: repeating-linear-gradient(45deg, var(--pink), var(--pink) 10px, #ff8da1 10px, #ff8da1 20px); }
        .card-back { background: white; transform: rotateY(180deg); border-color: var(--blue); padding: 10px; }

        /* DIARY */
        .diary-entry {
            background: white; border-radius: 12px; padding: 12px;
            margin-bottom: 10px; display: flex; gap: 10px;
            border-bottom: 3px solid #eee;
        }
        .mood-icon { font-size: 1.8rem; }

        /* NAVBAR */
        nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; border-top: 3px solid var(--pink);
            display: flex; justify-content: space-around; padding: 10px 0;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            z-index: 100;
        }
        .nav-btn {
            background: none; border: none; color: #aaa;
            display: flex; flex-direction: column; align-items: center; font-size: 0.7rem;
        }
        .nav-btn span { font-size: 1.4rem; margin-bottom: 2px; }
        .nav-btn.active { color: var(--pink); font-weight: bold; }

    </style>
</head>
<body>

<div class="scanlines"></div>

<div class="app-shell">
    <div class="marquee-container">
        <div class="marquee-text">
            ‚òÖ SEIREN OS v6.0 ‚òÖ BUDDY LIST ONLINE ‚òÖ NEW AVATAR SYSTEM INSTALLED ‚òÖ CHECK YOUR FORTUNE ‚òÖ GIRLS BRAVO FOREVER ‚òÖ
        </div>
    </div>

    <div class="content">

        <div id="tab-home" class="page active">
            
            <div id="setup-screen" style="text-align:center; padding:20px; display:none;">
                <h2 style="color:var(--pink);">Seiren ID Registration</h2>
                <p style="font-size:0.8rem; color:#666; margin-bottom:20px;">Please enter your details to generate your citizen card.</p>
                <input type="text" id="setup-name" placeholder="Name" style="margin-bottom:10px;">
                <input type="number" id="setup-age" placeholder="Age" style="margin-bottom:20px;">
                <button class="btn-main" onclick="createID()">GENERATE ID</button>
            </div>

            <div id="id-display" style="display:none;">
                <div class="id-card">
                    <div style="text-align:right; font-size:0.6rem; color:#aaa; margin-bottom:5px; letter-spacing:2px;">OFFICIAL CITIZEN CARD</div>
                    <div class="id-top-row">
                        <div class="avatar-frame">
                            <img id="my-avatar" class="avatar-img" src="" alt="Avatar">
                        </div>
                        <div class="id-info">
                            <h2 id="my-name" class="id-name">Loading...</h2>
                            <div class="id-meta">
                                Type: <span id="my-type" style="color:var(--blue); font-weight:bold;">Unknown</span><br>
                                ID#: <span id="my-serial">00000</span>
                            </div>
                            <div class="stat-row">
                                <span>POW</span>
                                <div class="stat-bar-bg"><div id="bar-pow" class="stat-bar-fill" style="width:50%;"></div></div>
                            </div>
                            <div class="stat-row">
                                <span>LUCK</span>
                                <div class="stat-bar-bg"><div id="bar-luck" class="stat-bar-fill" style="width:50%; background:linear-gradient(90deg, #ffd700, #ffeb3b);"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="fortune-area">
                    <h3 style="color:var(--deep-pink); margin-bottom:5px;">Daily Fortune</h3>
                    <p style="font-size:0.8rem; color:#888;">Tap to flip!</p>
                    <div class="card-wrap" id="fortune-card" onclick="flipFortune()">
                        <div class="card-face card-front">
                            <div style="background:white; padding:5px; border-radius:50%; width:40px; height:40px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:var(--pink);">?</div>
                        </div>
                        <div class="card-face card-back">
                            <div id="fortune-icon" style="font-size:3rem; margin-bottom:10px;">‚≠ê</div>
                            <strong id="fortune-title" style="color:var(--blue);">Lucky!</strong>
                            <p id="fortune-desc" style="font-size:0.8rem; margin-top:5px; color:#555;">You will find a coin.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-buddies" class="page">
            <h2 style="color:var(--blue); margin-bottom:10px;">Buddy List</h2>
            
            <div class="add-buddy-box">
                <input type="text" id="friend-input" placeholder="Enter Friend's Name...">
                <button onclick="addBuddy()" style="background:var(--pink); color:white; border:none; border-radius:8px; width:50px; font-weight:bold;">+</button>
            </div>

            <div class="buddy-container">
                <div class="buddy-header">
                    <span>My Friends (<span id="buddy-count">0</span>)</span>
                    <span>Online</span>
                </div>
                <div id="buddy-list" class="buddy-scroll">
                    </div>
            </div>
        </div>

        <div id="tab-diary" class="page">
            <h2 style="color:var(--pink);">Secret Diary</h2>
            
            <div style="background:white; padding:15px; border-radius:15px; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <button onclick="setMood('üòä')" class="mood-btn">üòä</button>
                    <button onclick="setMood('üò¢')" class="mood-btn">üò¢</button>
                    <button onclick="setMood('üò°')" class="mood-btn">üò°</button>
                    <button onclick="setMood('üíñ')" class="mood-btn">üíñ</button>
                    <button onclick="setMood('üí§')" class="mood-btn">üí§</button>
                </div>
                <textarea id="diary-text" style="width:100%; height:80px; padding:10px; border:2px solid #ddd; border-radius:10px; font-family:inherit; box-sizing:border-box;" placeholder="Dear Diary..."></textarea>
                <button class="btn-main" onclick="postDiary()" style="margin-top:10px;">Save Entry</button>
            </div>

            <div id="diary-feed"></div>
        </div>

    </div>

    <nav>
        <button class="nav-btn active" onclick="nav('home', this)"><span>üè†</span>Home</button>
        <button class="nav-btn" onclick="nav('buddies', this)"><span>üë•</span>Buddies</button>
        <button class="nav-btn" onclick="nav('diary', this)"><span>üìì</span>Diary</button>
    </nav>
</div>

<script>
    // === DATA STORE ===
    const DB = {
        user: JSON.parse(localStorage.getItem('seiren_user_v6')) || null,
        buddies: JSON.parse(localStorage.getItem('seiren_buddies_v6')) || [],
        diary: JSON.parse(localStorage.getItem('seiren_diary_v6')) || [],
        fortune: JSON.parse(localStorage.getItem('seiren_fortune_v6')) || { date: '', data: null }
    };

    let currentMood = 'üòä';

    // === INIT ===
    function init() {
        if (DB.user) {
            renderID();
            checkFortune();
        } else {
            document.getElementById('setup-screen').style.display = 'block';
        }
        renderBuddies();
        renderDiary();
    }

    // === 1. ID GENERATION (WITH IMAGE API) ===
    function createID() {
        const name = document.getElementById('setup-name').value;
        const age = document.getElementById('setup-age').value;
        if (!name) return;

        // Seiren Name Logic
        const seed = name.length + parseInt(age || 18);
        const prefixes = ["Mi", "Lu", "Fa", "Ko", "Ri", "Se", "Yu"];
        const suffixes = ["-chan", "-pyon", "ren", "la", "ne"];
        const animeName = prefixes[seed % prefixes.length] + suffixes[(seed * 2) % suffixes.length];

        DB.user = {
            realName: name,
            animeName: animeName,
            // USING DICEBEAR API FOR CUTE AVATARS
            avatarUrl: `https://api.dicebear.com/9.x/lorelei/svg?seed=${name}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc`,
            type: ["Tsundere", "Alien", "Dojikko", "Idol"][seed % 4],
            serial: Math.floor(Math.random() * 89999 + 10000),
            pow: Math.floor(Math.random() * 100),
            luck: Math.floor(Math.random() * 100)
        };

        localStorage.setItem('seiren_user_v6', JSON.stringify(DB.user));
        document.getElementById('setup-screen').style.display = 'none';
        renderID();
    }

    function renderID() {
        document.getElementById('id-display').style.display = 'block';
        document.getElementById('my-name').innerText = DB.user.animeName;
        document.getElementById('my-type').innerText = DB.user.type;
        document.getElementById('my-serial').innerText = DB.user.serial;
        document.getElementById('my-avatar').src = DB.user.avatarUrl;
        document.getElementById('bar-pow').style.width = DB.user.pow + "%";
        document.getElementById('bar-luck').style.width = DB.user.luck + "%";
    }

    // === 2. BUDDY LIST SYSTEM ===
    function addBuddy() {
        const input = document.getElementById('friend-input');
        const name = input.value;
        if (!name) return;

        // Generate Friend Stats Procedurally
        const seed = name.length * 5;
        const statuses = ["Eating Curry", "In the Bath", "Studying", "Sleepy", "Online"];
        
        const newBuddy = {
            name: name,
            // Unique avatar for them too!
            avatar: `https://api.dicebear.com/9.x/lorelei/svg?seed=${name}&backgroundColor=ffdfbf,c0aede`,
            status: statuses[Math.floor(Math.random() * statuses.length)]
        };

        DB.buddies.push(newBuddy);
        localStorage.setItem('seiren_buddies_v6', JSON.stringify(DB.buddies));
        input.value = "";
        renderBuddies();
    }

    function renderBuddies() {
        const list = document.getElementById('buddy-list');
        document.getElementById('buddy-count').innerText = DB.buddies.length;
        list.innerHTML = "";

        DB.buddies.forEach(buddy => {
            list.innerHTML += `
                <div class="buddy-item">
                    <img src="${buddy.avatar}" class="buddy-avatar">
                    <div class="buddy-info">
                        <span class="buddy-name">${buddy.name}</span>
                        <span class="buddy-status">~ ${buddy.status}</span>
                    </div>
                </div>
            `;
        });
    }

    // === 3. FORTUNE ===
    function checkFortune() {
        const today = new Date().toDateString();
        const card = document.getElementById('fortune-card');
        
        if (DB.fortune.date === today) {
            renderFortuneData(DB.fortune.data);
            card.style.transition = 'none';
            card.classList.add('flipped');
            setTimeout(() => card.style.transition = 'transform 0.6s', 50);
        } else {
            card.classList.remove('flipped');
        }
    }

    function flipFortune() {
        const today = new Date().toDateString();
        if (DB.fortune.date === today) return;

        const fortunes = [
            {icon:"üåü", title:"Super Lucky", desc:"A shiny object will appear!"},
            {icon:"üíñ", title:"Romance", desc:"Someone is thinking of you."},
            {icon:"üõÅ", title:"Wet Luck", desc:"Avoid water today..."},
            {icon:"üçû", title:"Food Luck", desc:"You will eat something tasty."}
        ];
        const res = fortunes[Math.floor(Math.random()*fortunes.length)];

        DB.fortune = { date: today, data: res };
        localStorage.setItem('seiren_fortune_v6', JSON.stringify(DB.fortune));
        
        renderFortuneData(res);
        document.getElementById('fortune-card').classList.add('flipped');
    }

    function renderFortuneData(data) {
        document.getElementById('fortune-icon').innerText = data.icon;
        document.getElementById('fortune-title').innerText = data.title;
        document.getElementById('fortune-desc').innerText = data.desc;
    }

    // === 4. DIARY ===
    function setMood(m) { currentMood = m; }
    
    function postDiary() {
        const txt = document.getElementById('diary-text').value;
        if(!txt) return;
        
        DB.diary.unshift({ date: new Date().toLocaleDateString(), mood: currentMood, text: txt });
        localStorage.setItem('seiren_diary_v6', JSON.stringify(DB.diary));
        document.getElementById('diary-text').value = "";
        renderDiary();
    }

    function renderDiary() {
        const feed = document.getElementById('diary-feed');
        feed.innerHTML = "";
        DB.diary.forEach(e => {
            feed.innerHTML += `
                <div class="diary-entry">
                    <div class="mood-icon">${e.mood}</div>
                    <div>
                        <div style="font-size:0.7rem; color:#aaa;">${e.date}</div>
                        <div>${e.text}</div>
                    </div>
                </div>
            `;
        });
    }

    // === NAV ===
    function nav(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    init();

    // PWA REGISTRATION
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
</script>

</body>
</html>
