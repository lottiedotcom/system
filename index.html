<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seiren OS</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff69b4">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3461/3461877.png">

    <style>
        /* --- 2004 MOE AESTHETIC --- */
        :root {
            --pink: #ff69b4;
            --light-pink: #fff0f5;
            --blue: #4fc3f7;
            --text: #555;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Verdana', sans-serif;
            background-color: #ffe4e1;
            background-image: 
                linear-gradient(90deg, rgba(255,255,255,.5) 50%, transparent 50%),
                linear-gradient(rgba(255,255,255,.5) 50%, transparent 50%);
            background-size: 40px 40px;
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            color: var(--text);
        }

        .scanlines {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.03) 50%);
            background-size: 100% 3px; pointer-events: none; z-index: 999;
        }

        .app-shell {
            width: 100%; max-width: 480px;
            background: var(--glass);
            display: flex; flex-direction: column;
            position: relative; height: 100%;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* HEADER */
        .marquee-container {
            background: linear-gradient(180deg, var(--pink), #ff1493);
            color: white; padding: 6px 0;
            white-space: nowrap; overflow: hidden; border-bottom: 3px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0; z-index: 10;
        }
        .marquee-text {
            display: inline-block; padding-left: 100%;
            animation: marquee 15s linear infinite; font-weight: bold; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 1px;
        }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* CONTENT */
        .content {
            flex: 1; 
            overflow-y: auto; 
            padding: 20px;
            padding-bottom: 100px; 
            scroll-behavior: smooth;
        }

        .page { display: none; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .page.active { display: block; }
        @keyframes popIn { from {opacity:0; transform:scale(0.95);} to {opacity:1; transform:scale(1);} }

        /* === HOME: ID CARD === */
        .id-card {
            background: #fff;
            border: 3px solid var(--blue); border-radius: 15px; padding: 15px;
            box-shadow: 5px 5px 0px rgba(79, 195, 247, 0.4);
            position: relative; overflow: hidden; margin-bottom: 25px;
        }
        .id-card::after {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.4) 50%, transparent 60%);
            animation: shine 3s infinite; pointer-events: none;
        }
        @keyframes shine { 0% {top:-150%;} 100% {top:150%;} }

        .id-layout { display: flex; gap: 15px; }
        .avatar-box {
            width: 80px; height: 80px; background: var(--light-pink);
            border: 2px solid var(--pink); border-radius: 10px;
            overflow: hidden; padding: 0;
        }
        /* Fix for Pinterest images to center them */
        .avatar-box img { width: 100%; height: 100%; object-fit: cover; }
        
        .id-info h2 { margin: 0; color: var(--pink); font-size: 1.3rem; text-transform: uppercase; border-bottom: 1px dashed #ccc; }
        .id-stats { font-size: 0.75rem; color: #666; margin-top: 5px; line-height: 1.5; }

        /* === BUDDY LIST === */
        .buddy-window {
            background: white; border: 2px solid #ccc; border-radius: 8px;
            display: flex; flex-direction: column; min-height: 300px;
        }
        .buddy-title {
            background: linear-gradient(180deg, #e0f7fa, #b2ebf2);
            padding: 8px; font-weight: bold; color: #444; font-size: 0.8rem;
            border-bottom: 1px solid #999; display: flex; justify-content: space-between;
        }
        
        .buddy-row {
            display: flex; align-items: center; gap: 10px; padding: 8px;
            border-bottom: 1px dotted #eee; transition: 0.2s;
        }
        .buddy-row:hover { background: #f0f8ff; }
        .buddy-row img { width: 40px; height: 40px; border-radius: 5px; border: 1px solid #ccc; object-fit: cover; }
        .buddy-status { font-size: 0.7rem; color: #888; font-style: italic; }

        .add-buddy-form { display: flex; gap: 5px; margin-bottom: 15px; }

        /* === PET === */
        .pet-container {
            background: white; border: 3px solid var(--pink); border-radius: 20px;
            padding: 20px; text-align: center; margin-bottom: 20px;
        }
        .pet-face { font-size: 4rem; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% {transform:translateY(0);} 50% {transform:translateY(-8px);} }
        
        .hunger-track { background: #eee; height: 12px; border-radius: 10px; margin: 10px 0; overflow: hidden; border: 1px solid #ccc; }
        .hunger-fill { height: 100%; background: linear-gradient(90deg, #ff9a9e, #ff69b4); width: 50%; transition: width 0.3s; }

        .task-item {
            background: white; padding: 10px; margin-bottom: 5px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #eee;
        }

        /* === DIARY === */
        .diary-paper {
            background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .mood-grid { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .mood-btn {
            font-size: 1.5rem; background: none; border: 2px solid transparent; border-radius: 50%;
            cursor: pointer; transition: 0.2s; width: 40px; height: 40px;
        }
        .mood-btn.selected { background: var(--light-pink); border-color: var(--pink); transform: scale(1.1); }
        
        .entry-bubble {
            background: white; padding: 10px; border-radius: 10px; margin-bottom: 8px;
            border: 1px solid #eee; border-left: 4px solid var(--blue);
            font-size: 0.9rem;
        }

        /* UI */
        input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family:inherit; }
        button { cursor: pointer; }
        .btn-pink {
            background: var(--pink); color: white; border: none; padding: 10px 20px;
            border-radius: 20px; font-weight: bold; box-shadow: 0 3px 0 #d12e87;
            width: 100%; margin-top: 5px;
        }
        .btn-pink:active { transform: translateY(3px); box-shadow: none; }
        .btn-small { width: auto; font-size: 1.2rem; padding: 5px 15px; }

        /* NAV */
        nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; border-top: 3px solid var(--pink);
            display: flex; justify-content: space-around; padding: 10px 0;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            z-index: 100;
        }
        .nav-btn {
            background: none; border: none; color: #aaa;
            display: flex; flex-direction: column; align-items: center; font-size: 0.7rem;
        }
        .nav-btn span { font-size: 1.5rem; margin-bottom: 2px; }
        .nav-btn.active { color: var(--pink); transform: scale(1.1); font-weight: bold; }

    </style>
</head>
<body>

<div class="scanlines"></div>

<div class="app-shell">
    <div class="marquee-container">
        <div class="marquee-text">
            ‚òÖ SEIREN OS v7.1 ‚òÖ MOE SYSTEM ONLINE ‚òÖ FEED MIHARU ‚òÖ ADD YOUR FRIENDS ‚òÖ GIRLS BRAVO ‚òÖ
        </div>
    </div>

    <div class="content">

        <div id="tab-home" class="page active">
            
            <div id="setup-screen" style="text-align:center; padding:20px; display:none;">
                <h2 style="color:var(--pink);">Create Profile</h2>
                <input type="text" id="setup-name" placeholder="Your Name" style="margin-bottom:10px;">
                <input type="number" id="setup-age" placeholder="Age" style="margin-bottom:10px;">
                <button class="btn-pink" onclick="createProfile()">ENTER WORLD</button>
            </div>

            <div id="id-display" style="display:none;">
                <div class="id-card">
                    <div style="text-align:right; font-size:0.6rem; letter-spacing:1px; color:#aaa; margin-bottom:5px;">SEIREN RESIDENT CARD</div>
                    <div class="id-layout">
                        <div class="avatar-box">
                            <img id="my-avatar" src="" alt="Avatar">
                        </div>
                        <div class="id-info">
                            <h2 id="my-name">Snow</h2>
                            <div class="id-stats">
                                <strong>Type:</strong> <span id="my-type">Tsundere</span><br>
                                <strong>Power:</strong> <span id="my-pow">80%</span><br>
                                <strong>ID:</strong> #<span id="my-id">2004</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align:center; margin-top:20px;">
                    <h3 style="color:var(--blue); margin-bottom:5px;">Daily Fortune</h3>
                    <div style="perspective:600px; height:200px; width:150px; margin:0 auto;" onclick="flipFortune()">
                        <div id="card-inner" style="position:relative; width:100%; height:100%; transition:transform 0.6s; transform-style:preserve-3d;">
                            <div style="position:absolute; width:100%; height:100%; backface-visibility:hidden; background:repeating-linear-gradient(45deg, var(--pink), var(--pink) 10px, #ffb7b2 10px, #ffb7b2 20px); border:4px solid white; border-radius:10px; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
                                <span style="font-size:3rem; color:white;">?</span>
                            </div>
                            <div style="position:absolute; width:100%; height:100%; backface-visibility:hidden; background:white; transform:rotateY(180deg); border:4px solid var(--blue); border-radius:10px; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:10px;">
                                <div id="fortune-icon" style="font-size:3rem;"></div>
                                <strong id="fortune-title" style="color:var(--pink); margin-top:10px;"></strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-buddies" class="page">
            <h2 style="color:var(--blue);">Buddy List</h2>
            
            <div class="add-buddy-form">
                <input type="text" id="buddy-input" placeholder="Friend's Name">
                <button class="btn-pink btn-small" onclick="addBuddy()">+</button>
            </div>

            <div class="buddy-window">
                <div class="buddy-title">
                    <span>Friends Online</span>
                    <span style="font-weight:normal;">_ ‚ñ° X</span>
                </div>
                <div id="buddy-list" class="buddy-list"></div>
            </div>
        </div>

        <div id="tab-pet" class="page">
            <div class="pet-container">
                <div id="pet-face" class="pet-face">üòÆ</div>
                <h3 style="color:var(--pink); margin:5px 0;">Miharu</h3>
                <div class="hunger-track">
                    <div id="hunger-bar" class="hunger-fill"></div>
                </div>
                <p id="pet-msg" style="font-size:0.8rem; color:#888;">Feed me curry!</p>
            </div>
            
            <h3>To-Do List</h3>
            <div class="add-buddy-form">
                <input type="text" id="task-input" placeholder="New Task...">
                <button class="btn-pink btn-small" onclick="addTask()">+</button>
            </div>
            <div id="task-list"></div>
        </div>

        <div id="tab-diary" class="page">
            <h2 style="color:var(--pink);">Secret Diary</h2>
            <div class="diary-paper">
                <div class="mood-grid">
                    <button class="mood-btn selected" onclick="setMood('üòä', this)">üòä</button>
                    <button class="mood-btn" onclick="setMood('üò¢', this)">üò¢</button>
                    <button class="mood-btn" onclick="setMood('üò°', this)">üò°</button>
                    <button class="mood-btn" onclick="setMood('üíñ', this)">üíñ</button>
                </div>
                <textarea id="diary-text" style="width:100%; height:80px; padding:10px; border:2px solid #eee; border-radius:8px; resize:none;" placeholder="Today I..."></textarea>
                <button class="btn-pink" onclick="saveDiary()">Save Entry</button>
            </div>
            <div id="diary-history"></div>
        </div>

    </div>

    <nav>
        <button class="nav-btn active" onclick="nav('home', this)"><span>üè†</span>Home</button>
        <button class="nav-btn" onclick="nav('buddies', this)"><span>üë•</span>Buddies</button>
        <button class="nav-btn" onclick="nav('pet', this)"><span>üçõ</span>Pet</button>
        <button class="nav-btn" onclick="nav('diary', this)"><span>üìì</span>Diary</button>
    </nav>
</div>

<script>
    // === YOUR AVATAR LIST ===
    // IMPORTANT: If these show as "Broken Icons", you need to replace them
    // with the "Direct Image Link" (ending in .jpg or .png)
    const MOE_ICONS = [
        "https://pin.it/6JIvCvYJR",
        "https://pin.it/hSRuAKKEP",
        "https://pin.it/2rUKEmLyX",
        "https://pin.it/3hejYOeqB",
        "https://pin.it/2C21xvl0G"
    ];

    // === APP LOGIC ===
    const DB = {
        user: JSON.parse(localStorage.getItem('seiren_v7_user')) || null,
        buddies: JSON.parse(localStorage.getItem('seiren_v7_buddies')) || [],
        pet: JSON.parse(localStorage.getItem('seiren_v7_pet')) || { hunger: 50, tasks: ['Drink Water'] },
        diary: JSON.parse(localStorage.getItem('seiren_v7_diary')) || [],
        fortune: JSON.parse(localStorage.getItem('seiren_v7_fortune')) || { date: '', icon: '', title: '' }
    };
    let currentMood = 'üòä';

    function init() {
        if(DB.user) { renderID(); checkFortune(); } 
        else { document.getElementById('setup-screen').style.display = 'block'; }
        renderBuddies(); renderPet(); renderDiary();
    }

    // 1. PROFILE
    function createProfile() {
        const name = document.getElementById('setup-name').value;
        const age = document.getElementById('setup-age').value;
        if(!name) return;

        const seed = name.length + parseInt(age||0);
        const pres = ["Mi", "Lu", "Fa", "Ko", "Ri", "Yu"];
        const sufs = ["-chan", "-pyon", "ren", "la"];
        const sName = pres[seed % pres.length] + sufs[(seed*3) % sufs.length];

        DB.user = {
            realName: name,
            seirenName: sName,
            avatar: MOE_ICONS[seed % MOE_ICONS.length],
            type: ["Tsundere", "Dojikko", "Alien", "Idol"][seed % 4],
            pow: Math.floor(Math.random()*100),
            id: Math.floor(Math.random()*9000)+1000
        };
        localStorage.setItem('seiren_v7_user', JSON.stringify(DB.user));
        document.getElementById('setup-screen').style.display = 'none';
        renderID();
    }

    function renderID() {
        document.getElementById('id-display').style.display = 'block';
        document.getElementById('my-name').innerText = DB.user.seirenName;
        document.getElementById('my-type').innerText = DB.user.type;
        document.getElementById('my-pow').innerText = DB.user.pow + "%";
        document.getElementById('my-id').innerText = DB.user.id;
        document.getElementById('my-avatar').src = DB.user.avatar;
    }

    // 2. FORTUNE
    function checkFortune() {
        const today = new Date().toDateString();
        if(DB.fortune.date === today) {
            document.getElementById('fortune-icon').innerText = DB.fortune.icon;
            document.getElementById('fortune-title').innerText = DB.fortune.title;
            const card = document.getElementById('card-inner');
            card.style.transition = 'none';
            card.style.transform = 'rotateY(180deg)';
        }
    }
    function flipFortune() {
        const today = new Date().toDateString();
        if(DB.fortune.date === today) return;

        const opts = [{i:"‚≠ê", t:"Lucky!"}, {i:"üõÅ", t:"Bath Portal!"}, {i:"üçõ", t:"Curry Day!"}, {i:"üíï", t:"Romance!"}];
        const res = opts[Math.floor(Math.random()*opts.length)];
        
        DB.fortune = { date: today, icon: res.i, title: res.t };
        localStorage.setItem('seiren_v7_fortune', JSON.stringify(DB.fortune));
        
        document.getElementById('fortune-icon').innerText = res.i;
        document.getElementById('fortune-title').innerText = res.t;
        document.getElementById('card-inner').style.transition = 'transform 0.6s';
        document.getElementById('card-inner').style.transform = 'rotateY(180deg)';
    }

    // 3. BUDDIES
    function addBuddy() {
        const name = document.getElementById('buddy-input').value;
        if(!name) return;
        
        const rIcon = MOE_ICONS[Math.floor(Math.random() * MOE_ICONS.length)];
        const stats = ["Eating Curry", "Sleeping", "Online", "Away"];
        
        DB.buddies.push({ name: name, avatar: rIcon, status: stats[Math.floor(Math.random()*stats.length)] });
        localStorage.setItem('seiren_v7_buddies', JSON.stringify(DB.buddies));
        document.getElementById('buddy-input').value = "";
        renderBuddies();
    }
    function renderBuddies() {
        const list = document.getElementById('buddy-list');
        list.innerHTML = "";
        DB.buddies.forEach(b => {
            list.innerHTML += `
                <div class="buddy-row">
                    <img src="${b.avatar}">
                    <div>
                        <div style="font-weight:bold; font-size:0.9rem;">${b.name}</div>
                        <div class="buddy-status">~ ${b.status}</div>
                    </div>
                </div>`;
        });
    }

    // 4. PET
    function renderPet() {
        const bar = document.getElementById('hunger-bar');
        bar.style.width = DB.pet.hunger + "%";
        document.getElementById('pet-face').innerText = DB.pet.hunger > 50 ? "üòã" : "üò´";
        document.getElementById('pet-msg').innerText = DB.pet.hunger > 50 ? "Miharu is full!" : "So hungry...";
        
        const list = document.getElementById('task-list');
        list.innerHTML = "";
        DB.pet.tasks.forEach(t => {
            list.innerHTML += `
                <div class="task-item">
                    <span>${t}</span>
                    <input type="checkbox" onclick="feed()">
                </div>`;
        });
    }
    function feed() {
        DB.pet.hunger = Math.min(100, DB.pet.hunger + 20);
        localStorage.setItem('seiren_v7_pet', JSON.stringify(DB.pet));
        renderPet();
    }
    function addTask() {
        const val = document.getElementById('task-input').value;
        if(val) {
            DB.pet.tasks.push(val);
            localStorage.setItem('seiren_v7_pet', JSON.stringify(DB.pet));
            document.getElementById('task-input').value = "";
            renderPet();
        }
    }

    // 5. DIARY
    function setMood(m, btn) {
        currentMood = m;
        document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }
    function saveDiary() {
        const txt = document.getElementById('diary-text').value;
        if(!txt) return;
        DB.diary.unshift({ date: new Date().toLocaleDateString(), mood: currentMood, text: txt });
        localStorage.setItem('seiren_v7_diary', JSON.stringify(DB.diary));
        document.getElementById('diary-text').value = "";
        renderDiary();
    }
    function renderDiary() {
        const div = document.getElementById('diary-history');
        div.innerHTML = "";
        DB.diary.forEach(e => {
            div.innerHTML += `
                <div class="entry-bubble">
                    <span style="font-size:1.2rem;">${e.mood}</span> 
                    <span style="color:#aaa; font-size:0.7rem;">${e.date}</span><br>
                    ${e.text}
                </div>`;
        });
    }

    function nav(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('tab-'+id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    init();

    if('serviceWorker' in navigator) {
        window.addEventListener('load', ()=>navigator.serviceWorker.register('./sw.js'));
    }
</script>

</body>
</html>
