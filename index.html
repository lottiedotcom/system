<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <meta name="apple-mobile-web-app-capable" content="yes">  
    <meta name="theme-color" content="#ff69b4">  
    <title>Seiren OS | System Hub</title>  
    <link rel="manifest" href="manifest.json">  

<style>  
    /* --- CORE VARIABLES --- */  
    :root {  
        --main: #ff69b4;   
        --font-main: 'Verdana', sans-serif;  
        --font-mono: 'Courier New', monospace;  
    }  

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }  

    body {  
        font-family: var(--font-main);  
        background-color: #ffe4e1;   
        background-image: radial-gradient(#ffb7b2 15%, transparent 16%), radial-gradient(#ffb7b2 15%, transparent 16%);  
        background-size: 20px 20px; background-position: 0 0, 10px 10px;  
        background-repeat: repeat;  
        background-attachment: fixed; 
        transition: all 0.8s ease;  
        margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden;  
        color: #444;   
    }  

    /* --- NIGHT MODE / DREAM SPACE --- */
    body.night-mode {
        background-color: #000 !important;
        background-image: none !important; 
        color: #b0c4de !important;
    }
    body.night-mode::before {
        content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background-image: url('https://i.postimg.cc/Zn1jB8Lc/Untitled86-20260119120235.jpg');
        background-size: cover; background-position: center; filter: blur(4px) brightness(0.8) contrast(1.1);
        transform: scale(1.1); z-index: -1; animation: dream-breathe 20s infinite alternate ease-in-out;
    }

    /* --- APP SHELL --- */  
    .app-shell {  
        width: 100%; max-width: 480px; background: transparent; 
        display: none; flex-direction: column; position: relative; height: 100%; z-index: 10; 
    }  
    
    .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 160px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }  
    .page { display: none; animation: popIn 0.3s; }  
    .page.active { display: block; }  
    @keyframes popIn { from {opacity:0; transform:scale(0.98);} to {opacity:1; transform:scale(1);} }  

    /* --- SYSTEM ALERT --- */
    .sys-alert {
        background: #ff4444; color: white; padding: 12px; font-weight: bold; 
        display: none; justify-content: space-between; align-items: center; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 200; border-bottom: 2px solid white;
        text-transform: uppercase; font-size: 0.9rem;
    }

    /* --- ID CARD --- */  
    .id-card-wrap {  
        background: #fff; border-radius: 15px; padding: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.15); 
        margin-bottom: 20px; position: relative; overflow: hidden; border: 1px solid #ccc;  
    }  
    .id-card-wrap::before {  
        content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;  
        background: linear-gradient(115deg, transparent 40%, rgba(255,0,150,0.1) 45%, rgba(0,255,255,0.1) 50%, rgba(255,255,0,0.1) 55%, transparent 60%);  
        animation: foil 5s linear infinite; pointer-events: none;
    }  
    @keyframes foil { 0% { transform: translate(0,0); } 100% { transform: translate(50%,50%); } }  

    .id-main { display: flex; gap: 15px; margin-top: 10px; }  
    .id-photo { width: 90px; height: 110px; background: #eee; border: 1px solid #999; object-fit: cover; }  
    .id-details { flex: 1; display: flex; flex-direction: column; gap: 4px; font-size: 0.7rem; }  
    .id-label { color: var(--main); font-weight: bold; text-transform: uppercase; font-size: 0.6rem; }  
    .id-val { color: #222; font-weight: bold; border-bottom: 1px dotted #ccc; display: block; margin-bottom: 4px; }  

    /* --- CHAT AREA --- */  
    .chat-shell { display: flex; height: 400px; border: 2px solid var(--main); border-radius: 15px; background: white; overflow: hidden; margin-top: 10px; }  
    .chat-view { flex: 1; display: flex; flex-direction: column; }  
    .chat-feed { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }  
    .pk-msg { display: flex; gap: 8px; align-items: flex-start; padding: 5px; border-radius: 8px; }  
    .pk-av { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }  
    .chat-input-area { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 8px; }  

    /* --- PHARMACY CARD --- */
    .loyalty-card {
        background: white; padding: 15px; border-radius: 10px; border: 1px solid #ccc;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 15px;
    }
    .stamp-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 10px; }
    .stamp-slot { aspect-ratio: 1/1; border: 2px dashed #bbb; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

    /* --- DREAM JOURNAL --- */
    .dream-entry { background: rgba(255,255,255,0.1); padding: 10px; border-left: 3px solid #7e57c2; margin-bottom: 10px; }
    .sensory-slider { margin-bottom: 10px; }

    /* --- UI COMPONENTS --- */  
    .btn-action { background: var(--main); color: white; padding: 12px; width: 100%; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 5px; }  
    .dock { position: fixed; bottom: 25px; left: 20px; right: 20px; background: white; border-radius: 25px; padding: 12px; display: flex; justify-content: space-between; box-shadow: 0 5px 25px rgba(0,0,0,0.1); z-index: 100; }  
    .dock-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; opacity: 0.5; }  
    .dock-btn.active { opacity: 1; transform: translateY(-5px); }  

    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }  
    .modal-card { background: white; width: 100%; max-width: 400px; border-radius: 20px; padding: 20px; max-height: 80vh; overflow-y: auto; }  
    input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; }  

</style>
</head>  

<body>  
<div id="welcome-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:3000; display:flex; flex-direction:column; align-items:center; justify-content:center;">  
    <h1 style="color:var(--main);">SEIREN OS</h1>  
    <p>v.2.0 System Hub</p>
    <button class="btn-action" style="width:200px;" onclick="enterSystem()">Enter System</button>  
</div>  

<div class="app-shell" id="app">  
    <div id="sys-alert" class="sys-alert">
        <span id="sys-alert-msg">‚ö†Ô∏è SYSTEM BROADCAST ACTIVE</span>
        <button onclick="dismissAlert()" style="background:none; border:none; color:white;">X</button>
    </div>

    <div class="content">
        <div id="page-dash" class="page active">  
            <div class="id-card-wrap">  
                <div class="id-header" style="display:flex; justify-content:space-between; font-weight:bold; font-size:0.7rem;">
                    <span id="sys-name-display">ANDROMEDA</span>
                    <span>SYSTEM ID</span>
                </div>
                <div class="id-main">  
                    <img id="dash-av" class="id-photo" src="">  
                    <div class="id-details">  
                        <span class="id-label">IDENTITY</span><span class="id-val" id="dash-name">...</span>
                        <span class="id-label">STATUS</span><span class="id-val" id="dash-status">Fronting</span>
                    </div>  
                </div>  
                <div style="margin-top:10px;">
                    <span class="id-label">PERSONNEL NOTES</span>
                    <div id="dash-bio" style="font-size:0.75rem; background:#f9f9f9; padding:8px; border-radius:5px; margin-top:4px;">...</div>
                </div>
            </div>  

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">  
                <button class="btn-action" onclick="openProfileModal()">üë• Switch Member</button>  
                <button class="btn-action" style="background:#4fc3f7;" onclick="sendAlert()">‚ö†Ô∏è Broadcast</button>  
                <button class="btn-action" style="background:#9575cd;" onclick="nav('dream')">üåô Dream Log</button>  
                <button class="btn-action" style="background:#607d8b;" onclick="exportData()">üíæ Backup Hub</button>  
            </div>  
        </div>  

        <div id="page-pharmacy" class="page">
            <h2>System Care</h2>
            <div class="loyalty-card">
                <div style="text-align:center; font-weight:bold; color:var(--main);">PRESCRIPTION REFILL CARD</div>
                <div class="stamp-grid" id="stamp-grid"></div>
                <p style="font-size:0.7rem; text-align:center; margin-top:10px;">Log symptoms to earn stamps.</p>
            </div>

            <div style="background:white; padding:15px; border-radius:15px;">
                <label>Log Symptom:</label>
                <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:5px; margin-top:10px;">
                    <button onclick="logSymptom('Panic')" style="padding:8px; font-size:0.7rem;">üò∞ Panic</button>
                    <button onclick="logSymptom('Non-verbal')" style="padding:8px; font-size:0.7rem;">üò∂ Silent</button>
                    <button onclick="logSymptom('Dissociated')" style="padding:8px; font-size:0.7rem;">üå´Ô∏è Numb</button>
                    <button onclick="logSymptom('Overstimulated')" style="padding:8px; font-size:0.7rem;">üí• Loud</button>
                    <button onclick="logSymptom('Blurry')" style="padding:8px; font-size:0.7rem;">üåÄ Blurry</button>
                    <button onclick="logSymptom('Little')" style="padding:8px; font-size:0.7rem;">üçº Little</button>
                </div>
            </div>
        </div>

        <div id="page-dream" class="page">
            <h2>Dream Archives</h2>
            <div style="background:white; padding:15px; border-radius:15px; margin-bottom:20px;">
                <input type="text" id="dream-loc" placeholder="Location (e.g. The Pool Rooms)">
                <textarea id="dream-text" placeholder="What happened?"></textarea>
                
                <div class="sensory-slider">
                    <label style="font-size:0.7rem;">REALITY VS GLITCH</label>
                    <input type="range" id="dream-reality" min="0" max="100">
                </div>

                <label style="display:block; background:#eee; padding:10px; text-align:center; border-radius:10px; cursor:pointer; margin-bottom:10px;">
                    üì∏ Upload Residue (Selfie/Image)
                    <input type="file" accept="image/*" style="display:none;" onchange="handleDreamImage(this)">
                </label>
                <img id="dream-preview" style="width:100%; display:none; border-radius:10px; margin-bottom:10px;">

                <button class="btn-action" style="background:#7e57c2;" onclick="saveDream()">Archive Log</button>
            </div>
            <div id="dream-feed"></div>
        </div>

        <div id="page-chat" class="page">  
            <div class="chat-shell">  
                <div class="chat-view">  
                    <div id="chat-feed" class="chat-feed"></div>  
                    <div class="chat-input-area">  
                        <label style="cursor:pointer; font-size:1.2rem;">üñºÔ∏è<input type="file" accept="image/*" style="display:none;" onchange="handleChatImage(this)"></label>
                        <input type="text" id="msg-in" placeholder="System Message...">  
                        <button onclick="sendMsg()" style="background:var(--main); color:white; border:none; padding:5px 15px; border-radius:8px;">Send</button>  
                    </div>  
                </div>  
            </div>  
        </div>  
    </div> 

    <div class="dock">  
        <button class="dock-btn active" onclick="nav('dash')">üè†</button>  
        <button class="dock-btn" onclick="nav('pharmacy')">üè•</button>  
        <button class="dock-btn" onclick="nav('chat')">üí¨</button>  
        <button class="dock-btn" onclick="toggleNightMode()">üåô</button>
    </div>
</div>  

<div id="modal-profile" class="modal">  
    <div class="modal-card">  
        <h3>Switch Member</h3>  
        <div id="prof-list"></div>  
        <hr>  
        <h4>Add Member</h4>  
        <input type="text" id="new-name" placeholder="Name">  
        <textarea id="new-bio" placeholder="Notes..."></textarea>
        <button class="btn-action" onclick="createProfile()">Add to System</button>
        <button class="btn-action" style="background:#ccc;" onclick="closeModals()">Close</button>  
    </div>
</div>  

<script>  
    let DB = {  
        sysName: "ANDROMEDA",  
        profiles: [{ name: "Runa", av: "", color: "#ff69b4", bio: "Hardware 25, Software 14", id: 1 }], 
        active: 0, 
        msgs: [], 
        dreams: [], 
        stamps: 0,
        alert: null
    };

    let tempChatImg = "";
    let tempDreamImg = "";

    window.onload = () => {  
        // Request persistent storage
        if (navigator.storage && navigator.storage.persist) {
            navigator.storage.persist().then(granted => console.log("Storage Persisted:", granted));
        }

        const saved = localStorage.getItem('seiren_system_v1'); 
        if(saved) DB = JSON.parse(saved);  
        refreshUI();
    };  

    function save() { localStorage.setItem('seiren_system_v1', JSON.stringify(DB)); }

    function enterSystem() {  
        document.getElementById('welcome-screen').style.display = 'none';  
        document.querySelector('.app-shell').style.display='flex'; 
        refreshUI(); 
    }  

    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-'+id).classList.add('active');
        document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
        if(id === 'chat') renderChat();
        if(id === 'dream') renderDreams();
    }

    function refreshUI() {
        const p = DB.profiles[DB.active];
        document.getElementById('dash-name').innerText = p.name;
        document.getElementById('dash-bio').innerText = p.bio;
        document.getElementById('dash-av').src = p.av || "https://cdn-icons-png.flaticon.com/512/2919/2919573.png";
        document.documentElement.style.setProperty('--main', p.color);
        renderStamps();
        renderAlert();
    }

    /* --- CHAT FUNCTIONS --- */
    function handleChatImage(input) {
        const reader = new FileReader();
        reader.onload = (e) => { tempChatImg = e.target.result; alert("Selfie attached!"); };
        reader.readAsDataURL(input.files[0]);
    }

    function sendMsg() {
        const input = document.getElementById('msg-in');
        if(!input.value && !tempChatImg) return;
        const p = DB.profiles[DB.active];
        DB.msgs.push({
            name: p.name,
            color: p.color,
            txt: input.value,
            img: tempChatImg,
            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
        });
        input.value = ""; tempChatImg = "";
        save(); renderChat();
    }

    function renderChat() {
        const feed = document.getElementById('chat-feed');
        feed.innerHTML = DB.msgs.map(m => `
            <div class="pk-msg">
                <div style="flex:1;">
                    <b style="color:${m.color}; font-size:0.8rem;">${m.name}</b> <small style="opacity:0.5;">${m.time}</small>
                    <div style="font-size:0.9rem;">${m.txt}</div>
                    ${m.img ? `<img src="${m.img}" style="max-width:200px; border-radius:10px; margin-top:5px;">` : ''}
                </div>
            </div>
        `).join('');
        feed.scrollTop = feed.scrollHeight;
    }

    /* --- PHARMACY --- */
    function logSymptom(s) {
        DB.stamps++;
        if(DB.stamps > 10) DB.stamps = 10;
        alert("Logged: " + s + ". Stamp added to card.");
        save(); renderStamps();
    }

    function renderStamps() {
        const grid = document.getElementById('stamp-grid');
        grid.innerHTML = "";
        for(let i=0; i<10; i++) {
            grid.innerHTML += `<div class="stamp-slot">${i < DB.stamps ? 'üíñ' : ''}</div>`;
        }
    }

    /* --- DREAM LOG --- */
    function handleDreamImage(input) {
        const reader = new FileReader();
        reader.onload = (e) => { 
            tempDreamImg = e.target.result; 
            const prev = document.getElementById('dream-preview');
            prev.src = tempDreamImg; prev.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }

    function saveDream() {
        const txt = document.getElementById('dream-text').value;
        if(!txt && !tempDreamImg) return;
        DB.dreams.unshift({
            loc: document.getElementById('dream-loc').value,
            txt: txt,
            img: tempDreamImg,
            reality: document.getElementById('dream-reality').value,
            date: new Date().toLocaleDateString()
        });
        document.getElementById('dream-text').value = "";
        document.getElementById('dream-preview').style.display = 'none';
        tempDreamImg = "";
        save(); renderDreams();
    }

    function renderDreams() {
        const feed = document.getElementById('dream-feed');
        feed.innerHTML = DB.dreams.map(d => `
            <div class="dream-entry">
                <small>${d.date} | ${d.loc}</small>
                <p>${d.txt}</p>
                ${d.img ? `<img src="${d.img}" style="width:100%; border-radius:5px; filter: grayscale(100%);">` : ''}
                <div style="height:4px; background:#eee; margin-top:5px;">
                    <div style="width:${d.reality}%; height:100%; background:var(--main);"></div>
                </div>
            </div>
        `).join('');
    }

    /* --- ALERTS --- */
    function sendAlert() {
        const msg = prompt("Enter Broadcast Message:");
        if(msg) { DB.alert = msg; save(); renderAlert(); }
    }
    function renderAlert() {
        const el = document.getElementById('sys-alert');
        if(DB.alert) {
            document.getElementById('sys-alert-msg').innerText = "‚ö†Ô∏è " + DB.alert;
            el.style.display = 'flex';
        } else el.style.display = 'none';
    }
    function dismissAlert() { DB.alert = null; save(); renderAlert(); }

    /* --- PROFILE MODAL --- */
    function openProfileModal() {
        document.getElementById('modal-profile').style.display = 'flex';
        const list = document.getElementById('prof-list');
        list.innerHTML = DB.profiles.map((p, i) => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
                <b>${p.name}</b>
                <button onclick="switchMember(${i})">Switch</button>
            </div>
        `).join('');
    }

    function switchMember(i) { DB.active = i; save(); refreshUI(); closeModals(); }

    function createProfile() {
        const name = document.getElementById('new-name').value;
        if(!name) return;
        DB.profiles.push({ name: name, bio: document.getElementById('new-bio').value, color: "#" + Math.floor(Math.random()*16777215).toString(16), id: Date.now() });
        save(); openProfileModal();
    }

    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    function toggleNightMode() { document.body.classList.toggle('night-mode'); }
    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(DB));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "seiren_system_backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
</script>  
</body>  
</html>

