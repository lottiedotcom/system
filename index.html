<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seiren OS</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff69b4">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3461/3461877.png">

    <style>
        /* --- CORE AESTHETIC --- */
        :root {
            --pink: #ff69b4;
            --deep-pink: #d12e87;
            --blue: #00bfff;
            --bg: #e0f7fa;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Verdana', sans-serif;
            background-color: var(--bg);
            /* Cute grid pattern */
            background-image: 
                linear-gradient(rgba(255, 105, 180, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 105, 180, 0.15) 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            color: #444;
        }

        .scanlines {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.02) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 999;
        }

        .app-shell {
            width: 100%; max-width: 480px;
            background: transparent;
            display: flex; flex-direction: column;
            position: relative; height: 100%;
        }

        /* HEADER */
        .marquee-container {
            background: var(--pink); color: white; padding: 5px 0;
            white-space: nowrap; overflow: hidden; border-bottom: 2px solid #ff1493;
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .marquee-text {
            display: inline-block; padding-left: 100%;
            animation: marquee 20s linear infinite; font-weight: bold; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 1px;
        }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .content {
            flex: 1; overflow-y: auto; padding: 20px;
            padding-bottom: 100px; /* Space for nav */
            scroll-behavior: smooth;
        }

        /* PAGES */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }

        /* === 1. COMPLEX ID CARD === */
        .id-card {
            background: #fff;
            border: 3px solid var(--blue); border-radius: 15px; padding: 15px;
            box-shadow: 5px 5px 0px rgba(0,191,255,0.2); position: relative; overflow: hidden;
            margin-bottom: 25px;
        }
        .id-header {
            display: flex; justify-content: space-between; border-bottom: 2px solid #eee;
            padding-bottom: 5px; margin-bottom: 10px; font-size: 0.7rem; color: #888; letter-spacing: 1px;
        }
        .id-main { display: flex; align-items: flex-start; gap: 15px; }
        .id-avatar {
            width: 80px; height: 80px; background: #fff0f5; border: 2px solid var(--pink);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 3rem;
        }
        .id-details h2 { margin: 0; color: var(--pink); font-size: 1.4rem; text-transform: uppercase; }
        .id-details p { margin: 2px 0; font-size: 0.8rem; color: #555; }
        
        .stat-bar { margin-top: 5px; display: flex; align-items: center; gap: 5px; font-size: 0.7rem; }
        .bar-bg { flex: 1; height: 6px; background: #eee; border-radius: 3px; }
        .bar-fill { height: 100%; background: var(--blue); border-radius: 3px; }
        
        .barcode {
            margin-top: 15px; height: 30px; background: repeating-linear-gradient(90deg, #333 0px, #333 2px, transparent 2px, transparent 4px);
            opacity: 0.7;
        }

        /* === FORTUNE CARD FLIP === */
        .fortune-scene { perspective: 600px; margin-top: 20px; height: 200px; cursor: pointer; }
        .card-object {
            width: 100%; height: 100%; position: relative; transition: transform 0.6s;
            transform-style: preserve-3d; border-radius: 15px;
        }
        .card-object.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Front (Before flip) */
        .card-front {
            background: linear-gradient(135deg, var(--pink), #ff9a9e);
            border: 4px solid white;
        }
        .card-front::after { content: "?"; font-size: 5rem; color: white; opacity: 0.8; font-weight: bold; }
        
        /* Back (After flip) */
        .card-back {
            background: white; transform: rotateY(180deg); border: 4px solid var(--blue);
            text-align: center; padding: 10px;
        }

        /* === DIARY === */
        .mood-selector { display: flex; justify-content: space-around; margin-bottom: 15px; }
        .mood-btn {
            font-size: 2rem; background: white; border: 2px solid transparent;
            border-radius: 50%; width: 50px; height: 50px; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .mood-btn.selected { border-color: var(--pink); background: #fff0f5; transform: scale(1.1); }
        
        .diary-input {
            width: 100%; height: 80px; padding: 12px; border: 2px solid #ddd; border-radius: 12px;
            font-family: inherit; margin-bottom: 10px; resize: none; box-sizing: border-box;
        }
        .diary-input:focus { outline: none; border-color: var(--blue); }
        
        .entry-list { display: flex; flex-direction: column; gap: 10px; }
        .entry-bubble {
            background: white; padding: 12px; border-radius: 12px; border-bottom: 3px solid #eee;
            display: flex; gap: 10px; align-items: flex-start;
        }
        .entry-mood { font-size: 1.5rem; background: #f8f8f8; padding: 5px; border-radius: 8px; }
        .entry-content { flex: 1; }
        .entry-date { font-size: 0.7rem; color: #aaa; margin-bottom: 4px; }
        .entry-text { font-size: 0.9rem; line-height: 1.4; }

        /* === SHARED & NAV === */
        .btn-action {
            background: var(--pink); color: white; border: none; padding: 12px;
            width: 100%; border-radius: 25px; font-weight: bold; font-size: 1rem;
            box-shadow: 0 4px 0 #c71585; cursor: pointer; margin-top: 10px;
        }
        .btn-action:active { transform: translateY(4px); box-shadow: none; }
        .btn-action:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }

        nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; border-top: 3px solid var(--pink);
            display: flex; justify-content: space-around; padding: 12px 0;
            padding-bottom: max(12px, env(safe-area-inset-bottom)); z-index: 100;
        }
        .nav-btn {
            background: none; border: none; font-size: 0.75rem; color: #999;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .nav-btn.active { color: var(--pink); font-weight: bold; }
        .nav-btn span { font-size: 1.4rem; }

        /* UTILS */
        .hidden { display: none !important; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; }

    </style>
</head>
<body>

<div class="scanlines"></div>

<div class="app-shell">
    <div class="marquee-container">
        <div class="marquee-text">
            ‚òÖ SEIREN OS v5.0 ‚òÖ ID VERIFICATION REQUIRED ‚òÖ DRAW YOUR DAILY CARD ‚òÖ KEEP YOUR DIARY UPDATED ‚òÖ GIRLS BRAVO ‚òÖ
        </div>
    </div>

    <div class="content">

        <div id="tab-home" class="page active">
            
            <div id="setup-screen" style="text-align:center; padding:20px; display:none;">
                <h2 style="color:var(--pink);">New Citizen Registration</h2>
                <input type="text" id="setup-name" placeholder="Enter Name">
                <input type="number" id="setup-age" placeholder="Age">
                <button class="btn-action" onclick="generateID()">CREATE ID</button>
            </div>

            <div id="id-display" class="hidden">
                <div class="id-card">
                    <div class="id-header">
                        <span>SEIREN HIGH SCHOOL</span>
                        <span id="id-serial">#000000</span>
                    </div>
                    <div class="id-main">
                        <div class="id-avatar" id="id-avatar">?</div>
                        <div class="id-details" style="flex:1;">
                            <h2 id="id-name">Loading...</h2>
                            <p><strong>Class:</strong> 2-B</p>
                            <p><strong>Type:</strong> <span id="id-type">Unknown</span></p>
                            
                            <div class="stat-bar">
                                <span>POW</span>
                                <div class="bar-bg"><div class="bar-fill" id="bar-pow" style="width:50%;"></div></div>
                            </div>
                            <div class="stat-bar">
                                <span>CUTE</span>
                                <div class="bar-bg"><div class="bar-fill" id="bar-cute" style="width:80%; background:#ff69b4;"></div></div>
                            </div>
                        </div>
                    </div>
                    <div class="barcode"></div>
                </div>

                <div style="text-align:center;">
                    <h3 style="color:var(--blue); margin-bottom:5px;">Daily Fortune Draw</h3>
                    <p style="font-size:0.8rem; color:#888;">Tap card to reveal ‚Ä¢ 1 per day</p>
                    
                    <div class="fortune-scene" onclick="flipCard()">
                        <div class="card-object" id="card-obj">
                            <div class="card-face card-front"></div>
                            <div class="card-face card-back">
                                <div style="font-size:3rem; margin-bottom:10px;" id="fortune-icon">‚≠ê</div>
                                <strong style="color:var(--pink); display:block; margin-bottom:5px;" id="fortune-title">Good Luck!</strong>
                                <span style="font-size:0.8rem; color:#666;" id="fortune-desc">You will find a shiny coin.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-friends" class="page">
            <h2 style="color:var(--blue);">Yearbook</h2>
            <div style="background:var(--glass); padding:15px; border-radius:15px; margin-bottom:20px;">
                <input type="text" id="friend-name" placeholder="Friend's Name">
                <button class="btn-action" style="margin-top:0;" onclick="addFriend()">Add Friend</button>
            </div>
            <div id="friend-list" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                </div>
        </div>

        <div id="tab-pet" class="page">
            <div style="background:white; border:3px solid var(--pink); border-radius:20px; padding:20px; text-align:center;">
                <div id="pet-face" style="font-size:5rem; animation:bounce 2s infinite;">üòÆ</div>
                <h3>Miharu</h3>
                <div style="background:#eee; height:15px; border-radius:10px; margin:15px 0; overflow:hidden;">
                    <div id="pet-bar" style="width:50%; height:100%; background:linear-gradient(90deg, #ff9a9e, #ff69b4); transition:width 0.5s;"></div>
                </div>
                <p id="pet-txt" style="font-size:0.8rem;">Hungry...</p>
            </div>
            
            <h3 style="margin-top:20px;">Tasks (Feeds Pet)</h3>
            <div id="task-list"></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="new-task" placeholder="Add task..." style="margin:0;">
                <button onclick="addTask()" style="background:var(--blue); color:white; border:none; width:50px; border-radius:8px; font-size:1.5rem;">+</button>
            </div>
        </div>

        <div id="tab-diary" class="page">
            <h2 style="color:var(--pink);">My Diary</h2>
            
            <div style="background:white; padding:15px; border-radius:15px; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-bottom:20px;">
                <div class="mood-selector">
                    <button class="mood-btn selected" onclick="selectMood('üòä', this)">üòä</button>
                    <button class="mood-btn" onclick="selectMood('üò¢', this)">üò¢</button>
                    <button class="mood-btn" onclick="selectMood('üò°', this)">üò°</button>
                    <button class="mood-btn" onclick="selectMood('üò¥', this)">üò¥</button>
                    <button class="mood-btn" onclick="selectMood('üíñ', this)">üíñ</button>
                </div>
                <textarea id="diary-text" class="diary-input" placeholder="How was your day?"></textarea>
                <button class="btn-action" onclick="saveEntry()">Post Entry</button>
            </div>

            <div id="diary-feed" class="entry-list">
                </div>
        </div>

    </div>

    <nav>
        <button class="nav-btn active" onclick="nav('home', this)"><span>üè†</span>Home</button>
        <button class="nav-btn" onclick="nav('friends', this)"><span>üìñ</span>Yearbook</button>
        <button class="nav-btn" onclick="nav('pet', this)"><span>üçõ</span>Miharu</button>
        <button class="nav-btn" onclick="nav('diary', this)"><span>‚úèÔ∏è</span>Diary</button>
    </nav>
</div>

<script>
    // === STATE MANAGEMENT ===
    const DB = {
        user: JSON.parse(localStorage.getItem('seiren_user')) || null,
        friends: JSON.parse(localStorage.getItem('seiren_friends')) || [],
        pet: JSON.parse(localStorage.getItem('seiren_pet')) || { hunger: 40, tasks: ["Drink Water"] },
        diary: JSON.parse(localStorage.getItem('seiren_diary')) || [],
        fortune: JSON.parse(localStorage.getItem('seiren_fortune')) || { date: "", data: null }
    };

    let currentMood = "üòä";

    // === INITIALIZE ===
    function init() {
        if(DB.user) {
            document.getElementById('id-display').classList.remove('hidden');
            renderID();
            checkFortuneDate();
        } else {
            document.getElementById('setup-screen').style.display = 'block';
        }
        renderFriends();
        renderPet();
        renderDiary();
    }

    // === ID SYSTEM ===
    function generateID() {
        const name = document.getElementById('setup-name').value;
        const age = document.getElementById('setup-age').value;
        if(!name || !age) return;

        // Random Generatpr
        const types = ["Tsundere", "Alien", "Dojikko", "Ghost", "Idol", "Student Council"];
        const avatars = ["üéÄ", "üëΩ", "üí¢", "üëª", "üé§", "üëì"];
        
        DB.user = {
            name: name,
            type: types[Math.floor(Math.random() * types.length)],
            avatar: avatars[Math.floor(Math.random() * avatars.length)],
            serial: "S-" + Math.floor(Math.random() * 90000 + 10000),
            pow: Math.floor(Math.random() * 100),
            cute: Math.floor(Math.random() * 100)
        };
        localStorage.setItem('seiren_user', JSON.stringify(DB.user));
        
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('id-display').classList.remove('hidden');
        renderID();
    }

    function renderID() {
        document.getElementById('id-name').innerText = DB.user.name;
        document.getElementById('id-serial').innerText = DB.user.serial;
        document.getElementById('id-type').innerText = DB.user.type;
        document.getElementById('id-avatar').innerText = DB.user.avatar;
        document.getElementById('bar-pow').style.width = DB.user.pow + "%";
        document.getElementById('bar-cute').style.width = DB.user.cute + "%";
    }

    // === FORTUNE SYSTEM ===
    function checkFortuneDate() {
        const today = new Date().toDateString();
        const card = document.getElementById('card-obj');

        if(DB.fortune.date === today) {
            // Already played today, show result immediately
            renderFortuneContent(DB.fortune.data);
            card.style.transition = 'none'; // No animation on load
            card.classList.add('flipped');
            // Re-enable transition after small delay
            setTimeout(() => card.style.transition = 'transform 0.6s', 100);
        } else {
            // New day, reset card
            card.classList.remove('flipped');
        }
    }

    function flipCard() {
        const today = new Date().toDateString();
        const card = document.getElementById('card-obj');

        if(DB.fortune.date === today) return; // Already flipped

        // Generate Fortune
        const fortunes = [
            {icon: "üåü", title: "Super Lucky", desc: "You will find money on the ground!"},
            {icon: "üõÅ", title: "Bathtub Alert", desc: "Watch out for portals in the bath."},
            {icon: "üçõ", title: "Spicy Day", desc: "Eat curry for extra power today."},
            {icon: "üíî", title: "Unlucky", desc: "You might trip on nothing."}
        ];
        const result = fortunes[Math.floor(Math.random() * fortunes.length)];

        // Save
        DB.fortune = { date: today, data: result };
        localStorage.setItem('seiren_fortune', JSON.stringify(DB.fortune));

        // Render & Animate
        renderFortuneContent(result);
        card.classList.add('flipped');
    }

    function renderFortuneContent(data) {
        document.getElementById('fortune-icon').innerText = data.icon;
        document.getElementById('fortune-title').innerText = data.title;
        document.getElementById('fortune-desc').innerText = data.desc;
    }

    // === DIARY SYSTEM ===
    function selectMood(mood, btn) {
        currentMood = mood;
        document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    function saveEntry() {
        const txt = document.getElementById('diary-text').value;
        if(!txt) return;

        DB.diary.unshift({
            date: new Date().toLocaleDateString(),
            mood: currentMood,
            text: txt
        });
        localStorage.setItem('seiren_diary', JSON.stringify(DB.diary));
        
        document.getElementById('diary-text').value = "";
        renderDiary();
    }

    function renderDiary() {
        const feed = document.getElementById('diary-feed');
        feed.innerHTML = "";
        DB.diary.forEach(e => {
            feed.innerHTML += `
                <div class="entry-bubble">
                    <div class="entry-mood">${e.mood}</div>
                    <div class="entry-content">
                        <div class="entry-date">${e.date}</div>
                        <div class="entry-text">${e.text}</div>
                    </div>
                </div>
            `;
        });
    }

    // === PET & FRIENDS (Simplified for brevity) ===
    function renderPet() {
        document.getElementById('pet-bar').style.width = DB.pet.hunger + "%";
        document.getElementById('pet-face').innerText = DB.pet.hunger > 50 ? "üòã" : "üò´";
        document.getElementById('pet-txt').innerText = DB.pet.hunger > 50 ? "Miharu is happy!" : "Feed me...";
        
        const list = document.getElementById('task-list');
        list.innerHTML = "";
        DB.pet.tasks.forEach(t => {
            list.innerHTML += `<div style="background:white; padding:10px; border-radius:8px; margin-bottom:5px; display:flex; justify-content:space-between;">
                ${t} <input type="checkbox" onclick="feedPet()">
            </div>`;
        });
    }
    function feedPet() {
        DB.pet.hunger = Math.min(100, DB.pet.hunger + 20);
        localStorage.setItem('seiren_pet', JSON.stringify(DB.pet));
        renderPet();
    }
    function addTask() {
        const val = document.getElementById('new-task').value;
        if(val) {
            DB.pet.tasks.push(val);
            localStorage.setItem('seiren_pet', JSON.stringify(DB.pet));
            document.getElementById('new-task').value = "";
            renderPet();
        }
    }
    function addFriend() {
        const name = document.getElementById('friend-name').value;
        if(name) {
            DB.friends.push(name);
            localStorage.setItem('seiren_friends', JSON.stringify(DB.friends));
            document.getElementById('friend-name').value = "";
            renderFriends();
        }
    }
    function renderFriends() {
        const list = document.getElementById('friend-list');
        list.innerHTML = "";
        DB.friends.forEach(f => {
            list.innerHTML += `<div style="background:white; padding:10px; border-radius:10px; text-align:center; box-shadow:2px 2px 0 #eee;">
                <div style="font-size:2rem;">üë§</div><div>${f}</div>
            </div>`;
        });
    }

    // === NAV ===
    function nav(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    init();

    // PWA
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
</script>

</body>
</html>
